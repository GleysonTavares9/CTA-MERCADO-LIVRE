<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Integra√ß√£o Gemini AI</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            background-color: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 10px 0;
            cursor: pointer;
            border-radius: 4px;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        #result {
            margin-top: 20px;
            padding: 15px;
            background-color: #e9e9e9;
            border-radius: 4px;
            white-space: pre-wrap;
            min-height: 100px;
        }
        .loading {
            color: #666;
            font-style: italic;
        }
    </style>
</head>
<body>
    <h1>Teste de Integra√ß√£o Gemini AI</h1>
    <p>Este teste verifica a comunica√ß√£o com a API do Google Gemini.</p>
    
    <div class="container">
        <h2>Dados do Produto de Teste</h2>
        <p><strong>Nome:</strong> Smartphone XYZ - 128GB, Tela 6.5", C√¢mera Tripla 48MP</p>
        <p><strong>Pre√ßo Original:</strong> R$ 1.999,90</p>
        <p><strong>Pre√ßo com Desconto:</strong> R$ 1.499,90</p>
        <p><strong>Avalia√ß√£o:</strong> 4.7/5 (1245 avalia√ß√µes)</p>
        
        <button id="testButton">Testar Integra√ß√£o</button>
        
        <h3>Resultado:</h3>
        <div id="result">Clique no bot√£o para testar a integra√ß√£o.</div>
    </div>

    <script type="module">
        document.getElementById('testButton').addEventListener('click', async () => {
            const resultDiv = document.getElementById('result');
            const button = document.getElementById('testButton');
            
            try {
                // Desabilitar o bot√£o durante o teste
                button.disabled = true;
                resultDiv.innerHTML = '<span class="loading">Testando integra√ß√£o com a API do Gemini... Aguarde.</span>';
                
                // Dados de exemplo para teste
                const testProductData = {
                    name: 'Smartphone XYZ - 128GB, Tela 6.5", C√¢mera Tripla 48MP',
                    originalPrice: 1999.90,
                    discountPrice: 1499.90,
                    rating: 4.7,
                    reviews: 1245,
                    description: 'Smartphone com processador r√°pido, tela AMOLED de 6.5 polegadas, c√¢mera tripla de 48MP + 8MP + 5MP, bateria de 5000mAh e carregamento r√°pido de 33W.',
                    category: 'Celulares e Smartphones',
                    image: 'https://http2.mlstatic.com/D_NQ_NP_123456-MLB12345678901_052021-O.jpg',
                    affiliateLink: 'https://mercadolivre.com.br/produto/1234567890/'
                };
                
                // Criar o prompt manualmente (igual ao que seria gerado no m√©todo createPrompt)
                const discount = testProductData.discountPrice ? 
                    testProductData.originalPrice - testProductData.discountPrice : 0;
                const discountPercent = testProductData.discountPrice
                    ? Math.round((discount / testProductData.originalPrice) * 100)
                    : 0;
                
                const prompt = `Voc√™ √© um especialista em marketing digital e afiliados do MercadoLivre. Crie uma mensagem de CTA (Call to Action) IRRESIST√çVEL para WhatsApp que converta visitantes em compradores.

DADOS DO PRODUTO:
üì¶ Nome: ${testProductData.name}
üí∞ Pre√ßo Original: R$ ${testProductData.originalPrice.toFixed(2).replace('.', ',')}
üî• Pre√ßo Promocional: R$ ${testProductData.discountPrice.toFixed(2).replace('.', ',')}
üí∏ Desconto: ${discountPercent}% OFF (Economia de R$ ${discount.toFixed(2).replace('.', ',')})
‚≠ê Avalia√ß√£o: ${testProductData.rating}/5 estrelas
üë• Reviews: ${testProductData.reviews} avalia√ß√µes
üìù Descri√ß√£o: ${testProductData.description}
üéØ Categoria: ${testProductData.category}

CONFIGURA√á√ïES:
üë§ P√∫blico-alvo: jovens
üé® Estilo: urgencia

INSTRU√á√ïES OBRIGAT√ìRIAS:
1. ‚úÖ Crie um T√çTULO IMPACTANTE com emojis que chame aten√ß√£o
2. ‚úÖ Use URG√äNCIA e ESCASSEZ para criar desejo imediato
3. ‚úÖ Destaque o DESCONTO e ECONOMIA de forma visual
4. ‚úÖ Liste 3-4 BENEF√çCIOS PRINCIPAIS com emojis
5. ‚úÖ Inclua PROVA SOCIAL (avalia√ß√µes, vendas)
6. ‚úÖ Use GATILHOS MENTAIS (exclusividade, tempo limitado)
7. ‚úÖ Termine com CTA FORTE e DIRETO
8. ‚úÖ Formate para WhatsApp (quebras de linha, emojis)
9. ‚úÖ N√ÉO inclua o link na mensagem
10. ‚úÖ M√°ximo 15 linhas para n√£o ficar muito longo`;
                
                // Mostrar o prompt no resultado
                resultDiv.innerHTML = `<strong>Prompt enviado para a API:</strong>\n\n${prompt}\n\n<hr>\n<strong>Resposta da API:</strong>\n<span class="loading">Aguardando resposta da API...</span>`;
                
                // Fazer a chamada para a API do Gemini
                const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=' + import.meta.env.VITE_GEMINI_API_KEY, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.7,
                            topK: 40,
                            topP: 0.95,
                            maxOutputTokens: 1024,
                        },
                    }),
                });
                
                const data = await response.json();
                
                if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                    const generatedText = data.candidates[0].content.parts[0].text;
                    resultDiv.innerHTML = `<strong>Prompt enviado para a API:</strong>\n\n${prompt}\n\n<hr>\n<strong>Resposta da API (${new Date().toLocaleTimeString()}):</strong>\n\n${generatedText}`;
                } else {
                    throw new Error('Resposta inv√°lida da API do Gemini');
                }
                
            } catch (error) {
                console.error('Erro ao testar integra√ß√£o com Gemini AI:', error);
                resultDiv.innerHTML = `<strong>‚ùå Erro ao testar integra√ß√£o:</strong>\n\n${error.message || 'Erro desconhecido'}\n\n<pre>${JSON.stringify(error, null, 2)}</pre>`;
            } finally {
                // Reabilitar o bot√£o ap√≥s o teste
                button.disabled = false;
            }
        });
    </script>
</body>
</html>
